@model BAtwitter_DAW_2526.Models.Echo

<!-- Aici vom insera recursia pt. parintii postarii -->

@* Echo + comments*@
@if(ViewBag.Message != null)
{
    <h2 class="p-3 rounded-3 text-center mb-5 alert @ViewBag.Type">@ViewBag.Message</h2>
}



<partial name="EchoInfo" model="Model" />

<br />
<br />

@* Afisare comentarii recursive - afisate exact ca postarile *@

@if (Model.Comments != null && Model.Comments.Any())
{
    <h5 class="mt-4 mb-3">Comments:</h5>
    @foreach (var comm in Model.Comments.OrderBy(c => c.DateCreated))
    {
        <partial name="CommentRecursion" model="@comm" />
    }
}


@* Afisarea formularului in care se poate adauga un comentariu *@

<div class="container">

    <div class="row">

        <div class="col-md-2"></div>

        <div class="col-md-8">

            <div class="card">

                <form method="post" asp-controller="Echoes" asp-action="Show">

                    <div class="card-body">

                        <input type="hidden" name="EchoId" value="@Model.Id" />

                        <label>Comment</label>
                        <br />

                        <textarea class="form-control" name="Content"></textarea>
                        <span asp-validation-for="Content" class="text-danger"></span>
                        <br /><br/>

                        <button class="btn btn-success" type="submit">Add Comment</button>

                    </div>

                </form>

            </div>

        </div>

        <div class="col-md-2"></div>

    </div>

</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.comment-card').forEach(function (card) {
                card.addEventListener('click', function (e) {

                    // se duce pe link doar daca este apasata postarea
                    if (e.target.closest('a, button')) {
                        return;
                    }

                    const url = card.getAttribute('data-comment-url');
                    if (url) {
                        window.location.href = url;
                    }
                });
            });
        });
    </script>
}
