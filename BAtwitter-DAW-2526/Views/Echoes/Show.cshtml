@model BAtwitter_DAW_2526.Models.Echo


@* Echo + commens*@

@if(ViewBag.Message != null)
{
    <h2 class="p-3 rounded-3 text-center mb-5 alert @ViewBag.Type">@ViewBag.Message</h2>
}

<div class="card">

    <partial name="EchoInfo" model="Model" />

    @if (Model.UserId == ViewBag.CurrentUser)
    {
        <div class="d-flex flex-row justify-content-between">

            <a class="btn btn-success" asp-controller="Echoes" asp-action="Edit" asp-route-id="@Model.Id">Modify Echo</a>

            <form method="post" asp-controller="Echoes" asp-action="Delete" asp-route-id="@Model.Id">

                <button class="btn btn-danger" type="submit">Delete Echo</button>

            </form>

        </div>
    }

</div>

<br />
<br />

@* Afisare comentarii recursive - afisate exact ca postarile *@

@if (Model.Comments != null && Model.Comments.Any())
{
    <h5 class="mt-4 mb-3">Comments:</h5>
    @foreach (var comm in Model.Comments.OrderBy(c => c.DateCreated))
    {
        <div class="container" style="margin-left: 0;">
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-8">
                    <div class="card">
                        <partial name="EchoInfo" model="comm" />
                        
                        <a class="btn btn-success" asp-controller="Echoes" asp-action="Show" asp-route-id="@comm.Id">View Echo</a>
                        
                        @if (comm.UserId == ViewBag.CurrentUser)
                        {
                            <div class="d-flex flex-row justify-content-between mt-2">
                                <a class="btn btn-success" asp-controller="Echoes" asp-action="Edit" asp-route-id="@comm.Id">Modify Echo</a>
                                <form method="post" asp-controller="Echoes" asp-action="Delete" asp-route-id="@comm.Id">
                                    <button class="btn btn-danger" type="submit">Delete Echo</button>
                                </form>
                            </div>
                        }
                    </div>
                    
                    @* Formular pentru răspuns la comentariu *@
                    <div class="card mt-2">
                        <form method="post" asp-controller="Echoes" asp-action="Show" class="p-3">
                            <input type="hidden" name="EchoId" value="@comm.Id" />
                            <div class="input-group">
                                <textarea class="form-control" name="Content" placeholder="Reply to this comment..." rows="2"></textarea>
                                <button class="btn btn-success" type="submit">Reply</button>
                            </div>
                        </form>
                    </div>
                    
                    @* Afișare recursivă a comentariilor la comentariu *@
                    @if (comm.Comments != null && comm.Comments.Any())
                    {
                        <div style="margin-left: 30px; border-left: 2px solid #ddd; padding-left: 15px; margin-top: 10px;">
                            @foreach (var subComm in comm.Comments.OrderBy(c => c.DateCreated))
                            {
                                <div class="card mt-2">
                                    <partial name="EchoInfo" model="subComm" />
                                    
                                    <a class="btn btn-success" asp-controller="Echoes" asp-action="Show" asp-route-id="@subComm.Id">View Echo</a>
                                    
                                    @if (subComm.UserId == ViewBag.CurrentUser)
                                    {
                                        <div class="d-flex flex-row justify-content-between mt-2">
                                            <a class="btn btn-success" asp-controller="Echoes" asp-action="Edit" asp-route-id="@subComm.Id">Modify Echo</a>
                                            <form method="post" asp-controller="Echoes" asp-action="Delete" asp-route-id="@subComm.Id">
                                                <button class="btn btn-danger" type="submit">Delete Echo</button>
                                            </form>
                                        </div>
                                    }
                                </div>
                                
                                @* Formular pentru răspuns la sub-comentariu *@
                                <div class="card mt-2">
                                    <form method="post" asp-controller="Echoes" asp-action="Show" class="p-3">
                                        <input type="hidden" name="EchoId" value="@subComm.Id" />
                                        <div class="input-group">
                                            <textarea class="form-control" name="Content" placeholder="Reply..." rows="2"></textarea>
                                            <button class="btn btn-success" type="submit">Reply</button>
                                        </div>
                                    </form>
                                </div>
                            }
                        </div>
                    }
                    
                    <br />
                </div>
                <div class="col-md-2"></div>
            </div>
        </div>
    }
}


@* Afisarea formularului in care se poate adauga un comentariu *@

<div class="container">

    <div class="row">

        <div class="col-md-2"></div>

        <div class="col-md-8">

            <div class="card">

                <form method="post" asp-controller="Echoes" asp-action="Show">

                    <div class="card-body">

                        <input type="hidden" name="EchoId" value="@Model.Id" />

                        <label>Comment content</label>
                        <br />

                        <textarea class="form-control" name="Content"></textarea>
                        <span asp-validation-for="Content" class="text-danger"></span>
                        <br /><br/>

                        <button class="btn btn-success" type="submit">Add Comment</button>

                    </div>

                </form>

            </div>

        </div>

        <div class="col-md-2"></div>

    </div>

</div>