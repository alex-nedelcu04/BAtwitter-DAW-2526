@{
    ViewData["Title"] = "Blocked Users";
}

@if (ViewBag.BlockedUsers != null && ((List<BAtwitter_DAW_2526.Models.UserProfile>)ViewBag.BlockedUsers).Any())
{
    @foreach (var blockedUser in ViewBag.BlockedUsers)
    {
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center gap-3">
                        @if (!string.IsNullOrEmpty(blockedUser.PfpLink))
                        {
                            <a href="@Url.Action("Show", "UserProfiles", new { username = blockedUser.ApplicationUser?.UserName })"
                               class="text-decoration-none">
                                <img src="@blockedUser.PfpLink" alt="Profile Picture"
                                     class="rounded-circle"
                                     style="width: 64px; height: 64px; object-fit: cover;" />
                            </a>
                        }
                        else
                        {
                            <div class="rounded-circle bg-secondary"
                                 style="width: 64px; height: 64px;"></div>
                        }
                        <div>
                            <h5 class="mb-0">
                                <a href="@Url.Action("Show", "UserProfiles", new { username = blockedUser.ApplicationUser?.UserName })"
                                   class="text-decoration-none">
                                    @blockedUser.DisplayName
                                </a>
                            </h5>
                            <small class="text-muted">@@@blockedUser.ApplicationUser?.UserName</small>
                            @if (!string.IsNullOrWhiteSpace(blockedUser.Description))
                            {
                                <p class="text-muted mb-0 mt-1" style="max-width: 400px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    @blockedUser.Description
                                </p>
                            }
                        </div>
                    </div>
                    <div>
                        <form method="post" asp-action="UnblockUser" asp-route-userIdToUnblock="@blockedUser.Id">
                            <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#unblockModal_@blockedUser.Id">
                                <i class="bi bi-person-x"></i> Unblock
                            </button>

                            <div class="modal fade" id="unblockModal_@blockedUser.Id" tabindex="-1" aria-labelledby="unblockModalLabel_@blockedUser.Id" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="unblockModalLabel_@blockedUser.Id">Unblock User</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            Are you sure you want to unblock @@@(blockedUser.ApplicationUser?.UserName)? You will be able to see their content again.
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                            <button type="submit" class="btn btn-success">Unblock</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    }
}

