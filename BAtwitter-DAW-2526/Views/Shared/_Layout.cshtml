<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - BAtwitter_DAW_2526</title>

    <script type="importmap"></script>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/BAtwitter-DAW-2526.styles.css" asp-append-version="true" />
    

    <script>
        (function() {
            const STORAGE_KEY = "theme";
            const root = document.documentElement;
            const saved = localStorage.getItem(STORAGE_KEY);
            const prefersDark = window.matchMedia?.("(prefers-color-scheme: dark)")?.matches;
            const theme = saved || (prefersDark ? "dark" : "light");
            root.setAttribute("data-bs-theme", theme);
        })();
    </script>
</head>

<body class="app-body">

    <!-- LEFT SIDEBAR (always visible) -->
    <aside class="app-sidebar bg-body-tertiary border-end">
        <div class="sidebar-header p-3">
            <a class="d-inline-flex align-items-center text-decoration-none"
               asp-area="" asp-controller="Home" asp-action="Index">
                <img src="~/Resources/Images/logo_transparent_v11_fit.png"
                     style="height: clamp(6.4vh, 35px, 60px); aspect-ratio: 1313/407; width:auto; object-fit:cover;"
                     alt="Site Logo">
            </a>
        </div>

        <!-- Always-open “dropdown” list -->
        <ul class="nav flex-column p-2 gap-1 sidebar-links">
            <li class="nav-item">
                <a class="nav-link" asp-area="" asp-controller="Home" asp-action="Index">
                    <i class="bi bi-house me-2"></i>Home
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" asp-area="" asp-controller="Echoes" asp-action="Index">
                    <i class="bi bi-list-ul me-2"></i>Main Feed
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" asp-area="" asp-controller="Echoes" asp-action="New">
                    <i class="bi bi-pencil-square me-2"></i>Send Echo
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" asp-area="" asp-controller="Flocks" asp-action="Index">
                    <i class="bi bi-people me-2"></i>Flock Feed
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" asp-area="" asp-controller="Flocks" asp-action="New">
                    <i class="bi bi-plus-circle me-2"></i>Create Flock
                </a>
            </li>

            @if (User.IsInRole("User") || User.IsInRole("Admin"))
            {
                <li class="nav-item">
                    <a class="nav-link" asp-area="" asp-controller="Echoes" asp-action="Bookmarks">
                        <i class="bi bi-bookmark-heart me-2"></i>View Bookmarks
                    </a>
                </li>
            }

            @if (User.IsInRole("Admin"))
            {
                <li class="nav-item">
                    <a class="nav-link" asp-area="" asp-controller="Echoes" asp-action="AdminInterface">
                        <i class="bi bi-shield-lock me-2"></i>Admin Interface
                    </a>
                </li>
            }
        </ul>

        <!-- BOTTOM-LEFT user area (fixed visually by sidebar layout) -->
        <div class="sidebar-user border-top p-2">
            <!-- Keep your existing user rendering logic -->
            <div class="user-slot w-100">
                <partial name="_LoginPartial" />
            </div>
        </div>
    </aside>


    <!-- TOP BAR (fixed) with search on the right -->
    <header class="app-topbar bg-body-tertiary border-bottom">
        <div class="h-100 px-3 d-flex align-items-center justify-content-between">
            <form class="app-search" method="get" asp-controller="Echoes" asp-action="Index">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-search"></i>
                    </span>
                    <input type="text" name="q" class="form-control" placeholder="Search..." />
                </div>
            </form>
            
            <div class="form-check form-switch ms-3 d-flex align-items-center gap-2">
                <input class="form-check-input" type="checkbox" role="switch" id="themeToggle" />
                <label class="form-check-label d-flex align-items-center" for="themeToggle" aria-label="Toggle dark mode">
                    <i id="themeIcon" class="bi bi-moon-stars"></i>
                </label>
            </div>
            <script>
                // Set toggle state immediately to prevent animation
                (function() {
                    const STORAGE_KEY = "theme";
                    const toggle = document.getElementById("themeToggle");
                    const icon = document.getElementById("themeIcon");
                    if (toggle && icon) {
                        const saved = localStorage.getItem(STORAGE_KEY);
                        const prefersDark = window.matchMedia?.("(prefers-color-scheme: dark)")?.matches;
                        const theme = saved || (prefersDark ? "dark" : "light");
                        toggle.checked = (theme === "dark");
                        icon.className = (theme === "dark") ? "bi bi-moon-stars" : "bi bi-sun";
                    }
                })();
            </script>
        </div>
    </header>


    <!-- MAIN CONTENT -->
    <main class="app-main">
        <div class="app-content">
            @RenderBody()
        </div>

    </main>


    <!-- BOTTOM-RIGHT floating message (TempData) -->
    @if (ViewBag.Message != null)
    {
        <div class="position-fixed bottom-0 end-0 p-3" style="z-index:2000;">
            <div class="alert @ViewBag.Type alert-dismissible fade show mb-0" role="alert">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="me-3"><b>@ViewBag.Message</b></div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            </div>
        </div>
    }



    <script src="~/lib/jquery/dist/jquery.min.js"></script>

    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>

    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
    
    <!-- Handle theme toggle changes -->
    <script>
        (function() {
            const STORAGE_KEY = "theme";
            const root = document.documentElement;
            const toggle = document.getElementById("themeToggle");
            const icon = document.getElementById("themeIcon");

            function applyTheme(theme) {
                root.setAttribute("data-bs-theme", theme);
                if (toggle) toggle.checked = (theme === "dark");
                if (icon) icon.className = (theme === "dark") ? "bi bi-moon-stars" : "bi bi-sun";
            }

            toggle?.addEventListener("change", function () {
                const theme = toggle.checked ? "dark" : "light";
                localStorage.setItem(STORAGE_KEY, theme);
                applyTheme(theme);
            });
        })();
    </script>
</body>


</html>


