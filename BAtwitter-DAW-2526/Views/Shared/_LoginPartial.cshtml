@using Microsoft.AspNetCore.Identity
@using BAtwitter_DAW_2526.Data
@using Microsoft.EntityFrameworkCore
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@inject ApplicationDbContext DbContext

@{
    // Get current user + profile (your existing logic)
    var currentUserId = UserManager.GetUserId(User);
    var currentUser = !string.IsNullOrEmpty(currentUserId) ? DbContext.Users.Find(currentUserId) : null;

    var userProfile = currentUser != null
        ? DbContext.UserProfiles
            .Include(up => up.ApplicationUser)
            .FirstOrDefault(up => up.Id == currentUser.Id)
        : null;

    var username = currentUser?.UserName ?? User.Identity?.Name;
    var pfpLink = userProfile?.PfpLink ?? "/Resources/Images/user_default_pfp.jpg";
}

<ul class="nav flex-column gap-1 m-0 p-0">
    @if (SignInManager.IsSignedIn(User))
    {
        <li class="nav-item">
            <a class="nav-link d-flex align-items-center rounded-3 px-2 py-2 link-body-emphasis"
               asp-controller="UserProfiles"
               asp-action="Show"
               asp-route-username="@username"
               title="View Profile">
                <img src="@pfpLink"
                     alt="Profile Picture"
                     class="rounded-circle me-2 flex-shrink-0"
                     style="width: 32px; height: 32px; object-fit: cover;" />
                <span style="min-width: 0; flex: 1; word-wrap: break-word; overflow-wrap: break-word;">Hello @@@username!</span>
            </a>
        </li>

        <li class="nav-item">
            <form asp-area="Identity"
                  asp-page="/Account/Logout"
                  asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })"
                  class="m-0">
                <button type="submit"
                        class="btn btn-link nav-link w-100 text-start rounded-3 px-2 py-2 link-body-emphasis">
                    <i class="bi bi-box-arrow-right me-2"></i>Logout
                </button>
            </form>
        </li>
    }
    else
    {
        <li class="nav-item">
            <a class="nav-link rounded-3 px-2 py-2 link-body-emphasis"
               asp-area="Identity" asp-page="/Account/Register">
                <i class="bi bi-person-plus me-2"></i>Register
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link rounded-3 px-2 py-2 link-body-emphasis"
               asp-area="Identity" asp-page="/Account/Login">
                <i class="bi bi-box-arrow-in-right me-2"></i>Login
            </a>
        </li>
    }
</ul>
